{% extends "base.html" %}
{% block title %}Contributor Intake • Nautical Compass{% endblock %}

{% block content %}
<div class="card">
  <h2>Contributor Intake</h2>
  <p class="muted">
    This is a <strong>fit discovery</strong> intake. No wrong answers — the system routes you into the best rail
    (Builders, Hardware, Sponsors, Ops, Capital, Advisors, etc.) so we can move fast.
  </p>

  <details class="dropdown" open>
    <summary>
      Quick Fit (60 seconds)
      <span class="badge">recommended</span>
    </summary>
    <div class="dropdown-body">
      <div class="grid">
        <div>
          <div class="label">What are you most interested in contributing to?</div>
          <select id="primary_interest">
            <option value="">Select…</option>
            <option value="build">Build / operate the ecosystem</option>
            <option value="hardware">Hardware / manufacturing / supply</option>
            <option value="sponsor">Sponsorship / partnerships</option>
            <option value="capital">Capital / investment</option>
            <option value="infra">Real estate / venue / infrastructure</option>
            <option value="advice">Advising / strategy</option>
            <option value="unknown">Not sure — route me</option>
          </select>
        </div>

        <div>
          <div class="label">What describes you best today?</div>
          <select id="contributor_type" required>
            <option value="">Select…</option>
            <option value="builder">Builder / Operator (execution)</option>
            <option value="manufacturer">Manufacturer / Vendor</option>
            <option value="sponsor">Sponsor / Partner</option>
            <option value="investor">Investor / Capital</option>
            <option value="advisor">Advisor / Specialist</option>
            <option value="operator">Ops / Sales / Growth</option>
          </select>
        </div>
      </div>
    </div>
  </details>

  <form class="form" id="contribForm">
    <div class="grid grid-2">
      <div>
        <div class="label">Name</div>
        <input name="name" required />
      </div>
      <div>
        <div class="label">Email</div>
        <input name="email" type="email" required />
      </div>
    </div>

    <div class="grid grid-2">
      <div>
        <div class="label">Phone (optional)</div>
        <input name="phone" />
      </div>
      <div>
        <div class="label">Company (optional)</div>
        <input name="company" />
      </div>
    </div>

    <div>
      <div class="label">Website (optional)</div>
      <input name="website" placeholder="https://..." />
    </div>

    <div class="grid grid-2">
      <div>
        <div class="label">Primary Role</div>
        <input name="primary_role" required placeholder="e.g., LED sales, AV ops, legal ops, finance, construction…" />
      </div>

      <div>
        <div class="label">Deal Preference</div>
        <select name="deal_preference" required>
          <option value="">Select…</option>
          <option value="cash">Cash</option>
          <option value="revshare">Revenue share</option>
          <option value="equity">Equity / upside</option>
          <option value="mixed">Mixed</option>
          <option value="sponsor">Sponsor / placement</option>
        </select>
      </div>
    </div>

    <div class="grid grid-2">
      <div>
        <div class="label">Home Region</div>
        <select name="home_region" required>
          <option value="">Select…</option>
          <option>DMV</option>
          <option>Northeast</option>
          <option>Southeast</option>
          <option>Midwest</option>
          <option>Southwest</option>
          <option>West Coast</option>
          <option>National</option>
          <option>Global</option>
        </select>
      </div>

      <div>
        <div class="label">Can Travel</div>
        <select name="can_travel" required>
          <option value="">Select…</option>
          <option>No</option>
          <option>Regional</option>
          <option>National</option>
          <option>International</option>
        </select>
      </div>
    </div>

    <div>
      <div class="label">Coverage Regions (optional)</div>
      <input name="coverage_regions" placeholder="Cities/states/regions you can cover" />
    </div>

    <details class="dropdown">
      <summary>
        Assets + Proof (optional)
        <span class="badge">boosts routing</span>
      </summary>
      <div class="dropdown-body">
        <div class="grid">
          <div>
            <div class="label">Assets (inventory, trucks, warehouse, capital, contacts)</div>
            <textarea name="assets" placeholder="What do you control access to?"></textarea>
          </div>

          <div>
            <div class="label">Specialties</div>
            <textarea name="specialties" placeholder="What are you uniquely good at?"></textarea>
          </div>

          <div>
            <div class="label">Certifications (optional)</div>
            <input name="certifications" placeholder="OSHA, rigging, PMP, etc." />
          </div>

          <div>
            <div class="label">Portfolio / Links (optional)</div>
            <input name="portfolio_links" placeholder="Links separated by commas" />
          </div>

          <div>
            <div class="label">References (optional)</div>
            <input name="references" placeholder="Names/companies/links" />
          </div>

          <div>
            <div class="label">Budget Range (optional — sponsors/manufacturers)</div>
            <input name="budget_range" placeholder="$ / month or budget range" />
          </div>
        </div>
      </div>
    </details>

    <div class="grid grid-2">
      <div>
        <div class="label">Weekly Availability</div>
        <select name="weekly_hours" required>
          <option value="">Select…</option>
          <option>0-5</option>
          <option>5-10</option>
          <option>10-20</option>
          <option>20-40</option>
          <option>40+</option>
        </select>
      </div>

      <div>
        <div class="label">Start Timeline</div>
        <select name="start_timeline" required>
          <option value="">Select…</option>
          <option>Now</option>
          <option>1-2 weeks</option>
          <option>30 days</option>
          <option>60+</option>
        </select>
      </div>
    </div>

    <div class="grid grid-2">
      <div>
        <div class="label">Alignment</div>
        <select name="alignment" required>
          <option value="">Select…</option>
          <option value="mission-first">Mission-first (rails + uplift)</option>
          <option value="balanced">Balanced (mission + profit)</option>
          <option value="profit-first">Profit-first (deal-by-deal)</option>
        </select>
      </div>

      <div>
        <div class="label">Non-negotiables (optional)</div>
        <input name="nonnegotiables" placeholder="Constraints / must-haves" />
      </div>
    </div>

    <!-- FIT EXTRACT (6–8 QUESTIONS) -->
    <details class="dropdown">
      <summary>
        Fit Extract (8 questions)
        <span class="badge">routes you faster</span>
      </summary>
      <div class="dropdown-body">
        <p class="muted" style="margin-top:0;">
          Optional — but if you answer these, the system can place you into the right rail immediately.
        </p>

        <div class="grid">
          <div>
            <div class="label">1) What do you have access to that most people don’t?</div>
            <textarea name="fit_access" placeholder="e.g., venue access, LED inventory, decision-makers, legal ops, funding, crews, warehouses…"></textarea>
          </div>

          <div>
            <div class="label">2) What are you trying to build personally in the next 12 months?</div>
            <textarea name="fit_build_goal" placeholder="What outcome are you aiming for?"></textarea>
          </div>

          <div>
            <div class="label">3) What kind of opportunities do you want from this ecosystem?</div>
            <select name="fit_opportunity">
              <option value="">Select…</option>
              <option value="deals">Deal flow / contracts</option>
              <option value="distribution">Distribution / channels</option>
              <option value="clients">Clients</option>
              <option value="partners">Partners</option>
              <option value="capital">Capital</option>
              <option value="jobs">Projects / work</option>
              <option value="community">Community / alignment</option>
              <option value="other">Other</option>
            </select>
          </div>

          <div>
            <div class="label">4) Decision power: can you sign, approve budgets, or move resources?</div>
            <select name="fit_authority">
              <option value="">Select…</option>
              <option value="yes_owner">Yes — owner/executive</option>
              <option value="yes_manager">Yes — manager/budget influence</option>
              <option value="partial">Partial</option>
              <option value="no">No</option>
            </select>
          </div>

          <div>
            <div class="label">5) What is your strongest lane right now?</div>
            <select name="fit_lane">
              <option value="">Select…</option>
              <option value="hardware">Hardware / manufacturing / supply</option>
              <option value="sales">Sales / partnerships</option>
              <option value="ops">Operations / execution</option>
              <option value="legal">Legal / compliance</option>
              <option value="finance">Finance / capital</option>
              <option value="realestate">Real estate / venue</option>
              <option value="tech">Software / engineering</option>
              <option value="creative">Creative / media</option>
              <option value="unsure">Not sure</option>
            </select>
          </div>

          <div>
            <div class="label">6) What would make this a “no” for you?</div>
            <textarea name="fit_no_conditions" placeholder="Red lines / dealbreakers / risks you won’t accept"></textarea>
          </div>

          <div>
            <div class="label">7) Are you willing to collaborate publicly (credits/visibility) or prefer quiet execution?</div>
            <select name="fit_visibility">
              <option value="">Select…</option>
              <option value="public">Public (credits/visibility ok)</option>
              <option value="quiet">Quiet (behind the scenes)</option>
              <option value="either">Either</option>
            </select>
          </div>

          <div>
            <div class="label">8) One sentence: why you?</div>
            <input name="fit_why_you" placeholder="What makes you the right person for your lane?" />
          </div>
        </div>
      </div>
    </details>

    <div>
      <div class="label">Message (optional)</div>
      <textarea name="message" placeholder="Anything else we should know?"></textarea>
    </div>

    <div class="btnrow">
      <button class="btn btn-primary" id="submitBtn" type="submit">Submit Contributor Intake</button>
    </div>

    <div id="responseBox" class="alert" style="display:none;"></div>
  </form>
</div>

<script>
  const form = document.getElementById("contribForm");
  const responseBox = document.getElementById("responseBox");
  const btn = document.getElementById("submitBtn");

  function showStatus(ok, msg){
    responseBox.style.display = "block";
    responseBox.className = "alert " + (ok ? "ok" : "bad");
    responseBox.innerText = msg;
  }

  form.addEventListener("submit", async (e) => {
    e.preventDefault();
    btn.disabled = true;
    btn.innerText = "Submitting…";

    try{
      const data = Object.fromEntries(new FormData(form).entries());

      // quick fit values
      const pi = document.getElementById("primary_interest")?.value || "";
      const ct = document.getElementById("contributor_type")?.value || "";
      if(pi) data.primary_interest = pi;
      if(ct) data.contributor_type = ct;

      const res = await fetch("/contributor", {
        method: "POST",
        headers: {"Content-Type":"application/json"},
        body: JSON.stringify(data)
      });
      const out = await res.json();
      if(res.ok){
        showStatus(true, `✔ Submitted. Rail: ${out.rail_assigned} • Score: ${out.score}`);
        form.reset();
      }else{
        showStatus(false, out.error || "⚠ Submission failed.");
      }
    }catch(err){
      showStatus(false, "⚠ Network error. Try again.");
    }finally{
      btn.disabled = false;
      btn.innerText = "Submit Contributor Intake";
    }
  });
</script>
{% endblock %}
