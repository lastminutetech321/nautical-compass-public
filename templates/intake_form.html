<!-- templates/intake_form.html — FULL SCRIPT (subscriber-only) -->
{% extends "base.html" %}
{% block title %}Subscriber Intake • Nautical Compass{% endblock %}

{% block content %}
<div class="card">
  <h2>Subscriber Intake</h2>
  <p class="muted">Member-only intake. Authorized email: <strong>{{ email }}</strong></p>

  <form class="form" method="post" action="/intake?token={{ token }}">
    <label class="label">Name</label>
    <input name="name" required />

    <label class="label">Email</label>
    <input name="email" type="email" required />

    <label class="label">Service Requested</label>
    <select name="service_requested" id="service_requested" required>
      <option value="">Select a service…</option>
      <option>Legal Intake Strategy</option>
      <option>Contract Review & Risk Mapping</option>
      <option>Demand Letter Drafting</option>
      <option>Arbitration Package Assembly</option>
      <option>Record Request Packet (FOIA-style)</option>
      <option>Dispute Timeline & Evidence Organization</option>
      <option>Complaint Framing & Narrative Structuring</option>
      <option>Platform / Marketplace Dispute Structuring</option>
      <option>Billing / Payments Dispute Structuring</option>
      <option>Other (explain in notes)</option>
    </select>

    <details class="dropdown">
      <summary>Full catalog dropdown (63+)</summary>
      <div class="dropdown-body">
        <div class="muted">If you don’t see your service above, pick “Other” and name it in Notes.</div>
        <div class="catalog-grid" style="margin-top:10px;">
          {% for item in [
            "Standing + Capacity Analysis","Injury / Damages Storyboard","Evidence Binder Build",
            "Settlement Term Sheet","Regulatory Complaint Draft","Small Claims Pack",
            "Vendor Contract Cleanup","SOW Builder","Invoice + Collections Pack","Policy Pack",
            "Missing Pay Packet","Misclassification Triage","Account Recovery Packet",
            "Deployment Rescue Plan","Security Baseline","Data Model Review","API Contract Draft",
            "AV Crew Role Mapping","LED Vendor Intake","Warehouse + Logistics Plan",
            "Director + Staff Sales System","Outbound Script Kit","Lead Qualification Ladder"
          ] %}
            <div class="catalog-item"><strong>{{ item }}</strong><span>Available rail (request in Notes if needed).</span></div>
          {% endfor %}
        </div>
      </div>
    </details>

    <label class="label">Notes (optional)</label>
    <textarea name="notes" id="notes" placeholder="Key facts, deadlines, what happened, what you want done…"></textarea>

    <details class="dropdown">
      <summary>Risk flags (instant)</summary>
      <div class="dropdown-body">
        <div id="riskFlags" class="muted">Select service + add notes to see risk flags.</div>
      </div>
    </details>

    <div class="btnrow">
      <button class="btn btn-primary" type="submit">Submit Intake</button>
      <a class="btn" href="/dashboard?token={{ token }}">Back to Dashboard</a>
    </div>
  </form>
</div>
{% endblock %}

{% block scripts %}
<script>
  const svc = document.getElementById("service_requested");
  const notes = document.getElementById("notes");
  const box = document.getElementById("riskFlags");

  function flags(){
    const f = [];
    const s = (svc.value || "").toLowerCase();
    const n = (notes.value || "");

    if(!svc.value) f.push("⚑ Scope not chosen yet (select a service).");
    if(n.length < 40) f.push("⚑ Low detail risk (add dates, parties, and desired outcome).");
    if(n.toLowerCase().includes("deadline") || n.toLowerCase().includes("court") || n.toLowerCase().includes("hearing"))
      f.push("⚑ Time-sensitive risk (confirm deadlines + preserve evidence).");

    if(s.includes("arbitration")) f.push("⚑ Arbitration fee + procedure exposure (needs tight packet).");
    if(s.includes("contract")) f.push("⚑ Contract leverage depends on clause language (attach key sections).");
    if(s.includes("billing") || s.includes("payments")) f.push("⚑ Payment trace required (stubs, invoices, receipts).");
    if(s.includes("platform")) f.push("⚑ Platform disputes require chronological policy/event log.");

    box.innerHTML = f.length ? f.map(x => `<div>${x}</div>`).join("") : "No flags yet.";
  }

  svc.addEventListener("change", flags);
  notes.addEventListener("input", flags);
  flags();
</script>
{% endblock %}
